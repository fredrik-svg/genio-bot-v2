# Mosquitto MQTT Broker Configuration
# För rpi-n8n-voice-assistant projektet

# =============================================================================
# Network Configuration
# =============================================================================

# Lyssna på MQTT port 1883 (standard MQTT utan TLS)
listener 1883
protocol mqtt

# Lyssna på WebSocket port 9001 (för web-baserade MQTT klienter)
listener 9001
protocol websockets

# Bind till alla nätverksgränssnitt (0.0.0.0 = alla)
# Detta gör att både lokala och externa klienter kan ansluta
# För endast lokal åtkomst, använd: bind_address 127.0.0.1
bind_address 0.0.0.0

# =============================================================================
# Security Configuration
# =============================================================================

# Tillåt anonym åtkomst (VARNING: Ej för produktion!)
# För produktion, sätt till false och använd password_file
allow_anonymous true

# För säker produktion, avkommentera följande och skapa lösenordsfil:
# allow_anonymous false
# password_file /mosquitto/config/passwd

# ACL (Access Control List) - valfritt för finare behörighetskontroll
# acl_file /mosquitto/config/acl.conf

# =============================================================================
# Persistence Configuration
# =============================================================================

# Aktivera persistence för att spara meddelanden vid omstart
persistence true
persistence_location /mosquitto/data/

# Autosave-intervall (sekunder)
autosave_interval 300

# =============================================================================
# Logging Configuration
# =============================================================================

# Logga till fil och stdout
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout

# Loggnivåer: error, warning, notice, information, debug
# För produktion: error, warning, notice
# För development: alla
log_type error
log_type warning
log_type notice
log_type information

# Tidsstämpel i loggen
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# =============================================================================
# Connection Configuration
# =============================================================================

# Max antal samtidiga anslutningar (0 = obegränsat)
max_connections -1

# Keepalive-intervall (sekunder)
# Klienter måste skicka PING inom detta intervall
keepalive_interval 60

# Max tid att vänta på CONNECT-meddelande (sekunder)
connect_timeout 10

# =============================================================================
# Message Configuration
# =============================================================================

# Max meddelandestorlek i bytes (0 = obegränsat)
# Satt till 10MB för att tillåta större payloads om nödvändigt
message_size_limit 10485760

# Max antal meddelanden i kö per klient
max_queued_messages 1000

# Quality of Service (QoS) nivåer
# 0 = At most once (ingen bekräftelse)
# 1 = At least once (bekräftelse krävs)
# 2 = Exactly once (dubbel bekräftelse)
max_qos 2

# =============================================================================
# Performance Tuning
# =============================================================================

# Antal trådar för nätverkshantering (auto = antal CPU-kärnor)
# För Raspberry Pi, kan sätta explicit värde om nödvändigt
# sys_interval 10

# =============================================================================
# Notes
# =============================================================================

# För att aktivera autentisering:
# 1. Skapa lösenordsfil: mosquitto_passwd -c /path/to/passwd username
# 2. Sätt allow_anonymous false
# 3. Avkommentera password_file ovan

# För TLS/SSL (säker anslutning):
# listener 8883
# cafile /mosquitto/config/ca.crt
# certfile /mosquitto/config/server.crt
# keyfile /mosquitto/config/server.key
# require_certificate false
