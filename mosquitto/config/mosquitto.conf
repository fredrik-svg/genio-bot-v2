# Mosquitto MQTT Broker Configuration
# För rpi-n8n-voice-assistant projektet

# =============================================================================
# Network Configuration
# =============================================================================

# Lyssna på MQTT port 1883 på alla nätverksgränssnitt
# Detta gör att både lokala och externa klienter kan ansluta
listener 1883 0.0.0.0

# Lyssna på WebSocket port 9001 (för web-baserade MQTT klienter)
listener 9001 0.0.0.0
protocol websockets

# =============================================================================
# Security Configuration
# =============================================================================

# Tillåt anonym åtkomst (VARNING: Ej för produktion!)
# För produktion, sätt till false och använd password_file
allow_anonymous true

# För säker produktion, avkommentera följande och skapa lösenordsfil:
# allow_anonymous false
# password_file /mosquitto/config/passwd

# ACL (Access Control List) - valfritt för finare behörighetskontroll
# acl_file /mosquitto/config/acl.conf

# =============================================================================
# Persistence Configuration
# =============================================================================

# Aktivera persistence för att spara meddelanden vid omstart
persistence true
persistence_location /mosquitto/data/

# Autosave-intervall (sekunder)
autosave_interval 300

# =============================================================================
# Logging Configuration
# =============================================================================

# Logga till stdout (bra för Docker)
log_dest stdout

# Loggnivåer: error, warning, notice, information, subscribe, unsubscribe
# För development: alla; För produktion: error, warning, notice
log_type error
log_type warning
log_type notice
log_type information

# Tidsstämpel i loggen
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# =============================================================================
# Connection Configuration
# =============================================================================

# Max antal samtidiga anslutningar (-1 = obegränsat)
max_connections -1

# Keepalive-intervall (sekunder)
# Klienter måste skicka PING inom detta intervall
max_keepalive 60

# =============================================================================
# Message Configuration
# =============================================================================

# Max paketstorlek i bytes (0 = obegränsat)
# Satt till 10MB för att tillåta större payloads om nödvändigt
max_packet_size 10485760

# Max antal meddelanden i kö per klient
max_queued_messages 1000

# =============================================================================
# Notes
# =============================================================================

# För att aktivera autentisering:
# 1. Skapa lösenordsfil: mosquitto_passwd -c /mosquitto/config/passwd username
# 2. Sätt allow_anonymous false
# 3. Avkommentera password_file ovan

# För TLS/SSL (säker anslutning):
# listener 8883
# cafile /mosquitto/config/ca.crt
# certfile /mosquitto/config/server.crt
# keyfile /mosquitto/config/server.key
# tls_version tlsv1.2
